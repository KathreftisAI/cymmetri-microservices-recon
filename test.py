# # from bson import ObjectId
import datetime
 
# # current_utc_time = datetime.datetime.utcnow()
 
# # application_id = "653f482a0d2e4b5f289727ff"
 
# # # logins = ['sahilp', 'sahil123', '74681']
 
# # # app_overdue = []
 
# # # l1 = [{'_id': ObjectId('6507e57052cf0e453e97303c'), 'displayName': 'sahil prabhune', 'firstName': 'sahil', 'lastName': 'prabhune', 'country': 'India', 'mobile': '', 'email': 'sahil.prabhune@cymmetri.com', 'userType': 'Employee', 'orgUnitId': '', 'department': '', 'designation': 'Data Scientist', 'status': 'DELETE', 'created': datetime.datetime(2023, 9, 18, 5, 51, 44, 662000), 'updated': datetime.datetime(2023, 12, 12, 18, 45, 10, 977000), 'created_by': 'shreyasp', 'updated_by': 'sahilp', 'assignedGroups': [], 'provisionedApps': {'CYMMETRI': {'appId': 'CYMMETRI', 'assignedRoles': ['USER'], 'login': {'login': 'sahilp', 'password': 'PbDToGcVwR0f9NlaNzgL71ugbzr1ssLtZ1YdL4/fH8nuG5ncLM0tGLHx5UKjNZhYeDd4Xwzl5pqu5od6/knayLex+FZIdUURqZw8UxOkL/I=', 'status': 'ACTIVE', 'pwdChangeCount': 0, 'authFailCount': 0, 'isForceChangePassword': False, 'neverExpiryPassword': False, 'isInitialLogin': False, 'createdTimeStamp': datetime.datetime(2023, 9, 18, 5, 51, 44, 656000), 'modifiedTimeStamp': datetime.datetime(2023, 9, 18, 5, 52, 24, 846000), 'lastLoginTime': datetime.datetime(2023, 11, 9, 6, 45, 54, 350000), 'lastPasswordChange': datetime.datetime(2023, 9, 18, 5, 52, 24, 846000), 'passwordExpiredAfter': datetime.datetime(2023, 12, 17, 5, 52, 24, 846000), 'passwordExpiryNotification': datetime.datetime(2023, 12, 7, 5, 52, 24, 734000)}}, '653f482a0d2e4b5f289727ff': {'appId': '653f482a0d2e4b5f289727ff', 'assignedRoles': [], 'login': {'status': 'DELETE_SSO', 'pwdChangeCount': 0, 'authFailCount': 0, 'isForceChangePassword': False, 'neverExpiryPassword': False, 'isInitialLogin': False, 'createdTimeStamp': datetime.datetime(2023, 11, 8, 10, 11, 19, 738000), 'formInstanceId': '', 'login': 'sahilp'}}}, 'attributes': [], 'version': 254, 'secondaryStatus': 'FINISHED', '_class': 'com.cymmetri.user.entity.User'}, {'_id': ObjectId('65e5a63beb282a4bc9bb0f0e'), 'displayName': 'Sahil Prabhu Prabhu', 'firstName': 'Sahil Prabhu', 'lastName': 'Prabhu', 'userType': 'Employee', 'orgUnitId': '', 'department': '', 'designation': '', 'status': 'ACTIVE', 'created': datetime.datetime(2024, 3, 4, 10, 45, 15, 510000), 'updated': datetime.datetime(2024, 3, 4, 10, 45, 15, 796000), 'created_by': 'prabhunesahil', 'updated_by': 'prabhunesahil', 'assignedGroups': [], 'provisionedApps': {'653f482a0d2e4b5f289727ff': {'appId': '653f482a0d2e4b5f289727ff', 'assignedRoles': [], 'login': {'login': 'sahil123', 'password': '', 'appUserId': 'sahil123', 'status': 'SUCCESS_CREATE', 'pwdChangeCount': 0, 'authFailCount': 0, 'isForceChangePassword': True, 'neverExpiryPassword': False, 'isInitialLogin': False, 'createdTimeStamp': datetime.datetime(2024, 3, 4, 10, 45, 15, 22000), 'modifiedTimeStamp': datetime.datetime(2024, 3, 4, 10, 45, 15, 22000), 'groupLink': 'CN=Sahil Prabhu,OU=SahilPrabhOU,DC=cymmetri,DC=in'}}, 'CYMMETRI': {'appId': 'CYMMETRI', 'assignedRoles': ['USER'], 'login': {'login': 'sahil123', 'password': 'tyMsMWSWgpPr49HLEkxGHIS93qSSzNvdoU7SuRi4zX0sMmjUoI7xmMWicb5edvBRU3xt29vdPwqs41irKUiWQY4dXMLDqbqr4RXtzK7CcEc=', 'pwdChangeCount': 0, 'authFailCount': 0, 'isForceChangePassword': True, 'neverExpiryPassword': False, 'isInitialLogin': True, 'createdTimeStamp': datetime.datetime(2024, 3, 4, 10, 45, 15, 498000), 'passwordExpiredAfter': datetime.datetime(2024, 6, 2, 10, 45, 15, 498000), 'passwordExpiryNotification': datetime.datetime(2024, 5, 23, 10, 45, 15, 498000)}}}, 'attributes': [], 'metaAttributes': {'createdBy': '653f482a0d2e4b5f289727ff', 'createdByRefType': 'APPLICATION', 'created': datetime.datetime(2024, 3, 4, 10, 45, 15, 796000)}, 'version': 1, '_class': 'com.cymmetri.user.entity.User', 'end_date': datetime.datetime(2023, 3, 4, 10, 45, 15, 510000)}, {'_id': ObjectId('65e5ce1e6d41db844e6916a0'), 'displayName': 'Ram Sreepada', 'firstName': 'Ram', 'lastName': 'Sreepada', 'country': 'India', 'email': '22839@edelweisstokio.in', 'userType': 'Employee', 'orgUnitId': '', 'employeeId': '22839', 'department': 'Sales', 'designation': '', 'status': 'ACTIVE', 'start_date': {'$date': '2017-08-16T00:00:00.000Z'}, 'created': {'$date': '2023-12-23T11:55:06.061Z'}, 'updated': {'$date': '2023-12-26T07:19:27.968Z'}, 'created_by': 'admin', 'updated_by': 'admin', 'assignedGroups': [], 'provisionedApps': {'CYMMETRI': {'appId': 'CYMMETRI', 'assignedRoles': ['USER'], 'login': {'login': '74681', 'password': 'txMJSE1R0dq8+OktLgLMYwdTNyepfzxck86TmrNCi9z/P7UbPSyhBF20tKFrJPE2bSM6dK5W+mTulBPsnYFpcCWj9MoPKBuKTjdQjzZ/7cU=', 'pwdChangeCount': 0, 'authFailCount': 0, 'isForceChangePassword': True, 'neverExpiryPassword': False, 'isInitialLogin': True, 'createdTimeStamp': {'$date': '2023-12-23T11:55:06.054Z'}, 'passwordExpiredAfter': {'$date': '2024-03-22T11:55:06.054Z'}, 'passwordExpiryNotification': {'$date': '2024-03-12T11:55:06.054Z'}}}, '653f482a0d2e4b5f289727ff': {'appId': '653f482a0d2e4b5f289727ff', 'assignedRoles': [], 'login': {'login': '74681', 'password': '', 'appUserId': '74681', 'status': 'SUCCESS_CREATE', 'pwdChangeCount': 0, 'authFailCount': 0, 'isForceChangePassword': True, 'neverExpiryPassword': False, 'isInitialLogin': False, 'createdTimeStamp': {'$date': '2023-12-23T11:55:05.479Z'}, 'modifiedTimeStamp': {'$date': '2023-12-23T11:55:05.479Z'}, 'groupLink': '74681'}}}, 'attributes': [{'name': 'Employee type', 'value': 'Employee', 'converterType': 'STRING'}, {'name': 'Office Address', 'value': '3-1-273 Hanamkonda Kakatiya colony,          506001', 'converterType': 'STRING'}, {'name': 'Middle name', 'value': 'Mohan', 'converterType': 'STRING'}, {'name': 'Reporting manager id', 'value': '22456', 'converterType': 'STRING'}], 'metaAttributes': {'createdBy': '658574b7efe7224ee74ba6f2', 'updatedBy': '658574b7efe7224ee74ba6f2', 'createdByRefType': 'APPLICATION', 'updatedByRefType': 'APPLICATION', 'created': {'$date': '2023-12-23T11:55:06.280Z'}, 'updated': {'$date': '2023-12-26T07:19:27.968Z'}}, 'version': {'$numberLong': '7'}, '_class': 'com.cymmetri.user.entity.User', 'end_date': datetime.datetime(2024, 1, 22, 11, 55, 6, 61000)}]
 
# # # for user in l1:
# # #     # Check if user["provisionedApps"] is a dictionary
# # #     if isinstance(user["provisionedApps"], dict):
# # #         # Check if applicationId exists in provisionedApps
# # #         if applicationId in user["provisionedApps"]:
# # #             # Check the conditions for the user
# # #             if "end_date" in user and user["end_date"] < current_utc_time and \
# # #                user["status"] == "ACTIVE" and \
# # #                user["provisionedApps"][applicationId]["login"]["status"] not in ["SUCCESS_DELETE", "SUCCESS_UPDATE"]:
# # #                     app_overdue.append(user)
 
# # # # Printing the result
# # # # print("Users matching the conditions:")
# # # # for user in app_overdue:
# # # #     print(user)
                    
# # # print(len(app_overdue))


# # app_overdue =  [{'_id': ObjectId('65e5a63beb282a4bc9bb0f0e'), 'displayName': 'Sahil Prabhu Prabhu', 'firstName': 'Sahil Prabhu', 'lastName': 'Prabhu', 'userType': 'Employee', 'orgUnitId': '', 'department': '', 'designation': '', 'status': 'ACTIVE', 'created': datetime.datetime(2024, 3, 4, 10, 45, 15, 510000), 'updated': datetime.datetime(2024, 3, 4, 10, 45, 15, 796000), 'created_by': 'prabhunesahil', 'updated_by': 'prabhunesahil', 'assignedGroups': [], 'provisionedApps': {'653f482a0d2e4b5f289727ff': {'appId': '653f482a0d2e4b5f289727ff', 'assignedRoles': [], 'login': {'login': 'sahil123', 'password': '', 'appUserId': 'sahil123', 'status': 'SUCCESS_CREATE', 'pwdChangeCount': 0, 'authFailCount': 0, 'isForceChangePassword': True, 'neverExpiryPassword': False, 'isInitialLogin': False, 'createdTimeStamp': datetime.datetime(2024, 3, 4, 10, 45, 15, 22000), 'modifiedTimeStamp': datetime.datetime(2024, 3, 4, 10, 45, 15, 22000), 'groupLink': 'CN=Sahil Prabhu,OU=SahilPrabhOU,DC=cymmetri,DC=in'}}, 'CYMMETRI': {'appId': 'CYMMETRI', 'assignedRoles': ['USER'], 'login': {'login': 'sahil123', 'password': 'tyMsMWSWgpPr49HLEkxGHIS93qSSzNvdoU7SuRi4zX0sMmjUoI7xmMWicb5edvBRU3xt29vdPwqs41irKUiWQY4dXMLDqbqr4RXtzK7CcEc=', 'pwdChangeCount': 0, 'authFailCount': 0, 'isForceChangePassword': True, 'neverExpiryPassword': False, 'isInitialLogin': True, 'createdTimeStamp': datetime.datetime(2024, 3, 4, 10, 45, 15, 498000), 'passwordExpiredAfter': datetime.datetime(2024, 6, 2, 10, 45, 15, 498000), 'passwordExpiryNotification': datetime.datetime(2024, 5, 23, 10, 45, 15, 498000)}}}, 'attributes': [], 'metaAttributes': {'createdBy': '653f482a0d2e4b5f289727ff', 'createdByRefType': 'APPLICATION', 'created': datetime.datetime(2024, 3, 4, 10, 45, 15, 796000)}, 'version': 1, '_class': 'com.cymmetri.user.entity.User', 'end_date': datetime.datetime(2023, 3, 4, 10, 45, 15, 510000)}, {'_id': ObjectId('65e5ce1e6d41db844e6916a0'), 'displayName': 'Ram Sreepada', 'firstName': 'Ram', 'lastName': 'Sreepada', 'country': 'India', 'email': '22839@edelweisstokio.in', 'userType': 'Employee', 'orgUnitId': '', 'employeeId': '22839', 'department': 'Sales', 'designation': '', 'status': 'ACTIVE', 'start_date': {'$date': '2017-08-16T00:00:00.000Z'}, 'created': {'$date': '2023-12-23T11:55:06.061Z'}, 'updated': {'$date': '2023-12-26T07:19:27.968Z'}, 'created_by': 'admin', 'updated_by': 'admin', 'assignedGroups': [], 'provisionedApps': {'CYMMETRI': {'appId': 'CYMMETRI', 'assignedRoles': ['USER'], 'login': {'login': '74681', 'password': 'txMJSE1R0dq8+OktLgLMYwdTNyepfzxck86TmrNCi9z/P7UbPSyhBF20tKFrJPE2bSM6dK5W+mTulBPsnYFpcCWj9MoPKBuKTjdQjzZ/7cU=', 'pwdChangeCount': 0, 'authFailCount': 0, 'isForceChangePassword': True, 'neverExpiryPassword': False, 'isInitialLogin': True, 'createdTimeStamp': {'$date': '2023-12-23T11:55:06.054Z'}, 'passwordExpiredAfter': {'$date': '2024-03-22T11:55:06.054Z'}, 'passwordExpiryNotification': {'$date': '2024-03-12T11:55:06.054Z'}}}, '653f482a0d2e4b5f289727ff': {'appId': '653f482a0d2e4b5f289727ff', 'assignedRoles': [], 'login': {'login': '74681', 'password': '', 'appUserId': '74681', 'status': 'SUCCESS_CREATE', 'pwdChangeCount': 0, 'authFailCount': 0, 'isForceChangePassword': True, 'neverExpiryPassword': False, 'isInitialLogin': False, 'createdTimeStamp': {'$date': '2023-12-23T11:55:05.479Z'}, 'modifiedTimeStamp': {'$date': '2023-12-23T11:55:05.479Z'}, 'groupLink': '74681'}}}, 'attributes': [{'name': 'Employee type', 'value': 'Employee', 'converterType': 'STRING'}, {'name': 'Office Address', 'value': '3-1-273 Hanamkonda Kakatiya colony,          506001', 'converterType': 'STRING'}, {'name': 'Middle name', 'value': 'Mohan', 'converterType': 'STRING'}, {'name': 'Reporting manager id', 'value': '22456', 'converterType': 'STRING'}], 'metaAttributes': {'createdBy': '658574b7efe7224ee74ba6f2', 'updatedBy': '658574b7efe7224ee74ba6f2', 'createdByRefType': 'APPLICATION', 'updatedByRefType': 'APPLICATION', 'created': {'$date': '2023-12-23T11:55:06.280Z'}, 'updated': {'$date': '2023-12-26T07:19:27.968Z'}}, 'version': {'$numberLong': '7'}, '_class': 'com.cymmetri.user.entity.User', 'end_date': datetime.datetime(2024, 1, 22, 11, 55, 6, 61000)}]

# # final_app_overdue = []

# # for user in app_overdue:
# #     # Extracting desired attributes from each user
# #     user_data = {
# #         "cymmetriLogin": user["provisionedApps"]["CYMMETRI"]["login"]["login"],
# #         "appLogin": user["provisionedApps"][application_id]["login"]["login"],
# #         "status": user["status"],
# #         "appStatus": user["provisionedApps"][application_id]["login"]["status"],
# #         "end_date": user.get("end_date", None)
# #     }
# #     final_app_overdue.append(user_data)

# # # Printing the final list
# # print("final_app_overdue:", final_app_overdue)
# from pymongo import MongoClient
# from datetime import datetime
# import redis 
# import json 



# # Key for Redis hash
# redis_key = 'cymmetri-datascience_sh_recon_65f16ea71eea4028c1fa4c32_f595e9a3-77dd-476a-a424-3336552e3bac'

# # Connect to Redis
# redis_client = redis.StrictRedis(host=REDIS_HOST,
#                                  port=REDIS_PORT,
#                                  username=REDIS_USERNAME,
#                                  password=REDIS_PASSWORD,
#                                  db=REDIS_DATABASE,
#                                  decode_responses=True)


# # Fetch hash data from Redis
# hash_data = redis_client.hgetall(redis_key)

# # Extract required fields
# cymmetri_logins = json.loads(hash_data.get("Cymmetri_logins", "[]"))
# final_app_overdue = json.loads(hash_data.get("final_app_overdue", "[]"))

# # Convert final_app_overdue to set
# #final_app_overdue_set = {item["cymmetriLogin"] for item in final_app_overdue}

# print("Cymmetri_logins:", cymmetri_logins)
# print("Final App Overdue Set:", final_app_overdue)





# # def find_break_types(target_logins, cymmetri_logins, final_overdue):
# #     # Find break_type_in_target_only
# #     break_type_in_target_only = target_logins - set(cymmetri_logins)
    
# #     # Find break_type_in_cymmetri_only
# #     break_type_in_cymmetri_only = set(cymmetri_logins) - target_logins
    
# #     # Find app_overdue_logins_cymmetri
# #     app_overdue_logins_cymmetri = [item['cymmetriLogin'] for item in final_overdue]
    
# #     # Find app_overdue_logins_target
# #     app_overdue_logins_target = [item['appLogin'] for item in final_overdue]
    
# #     # Find break_type_overdue
# #     break_type_overdue = set(target_logins).intersection(app_overdue_logins_cymmetri)
    
# #     return break_type_in_target_only, break_type_in_cymmetri_only, break_type_overdue

# # # Call the function with the required inputs
# # break_type_in_target_only, break_type_in_cymmetri_only, break_type_overdue = find_break_types(Target_logins, Cymmetri_Logins, Final_Overdue)

# # # Print the results
# # print("break_type_in_target_only:", break_type_in_target_only)
# # print("break_type_in_cymmetri_only:", break_type_in_cymmetri_only)
# # print("break_type_overdue:", break_type_overdue)


# Target_logins =  {'Padma.Begum', '18099', 'niyra', '18105', '32802', '17036', '34386', '17038', '34407', '17972', '33917', 'Cymmetri', 'LTB150012', '34329', '33336', 'Arjun.Patil', 'devbramhma', '16506', 'Parminder.Kaur', 'test.pod', 'rohit', "Sankar.D'Cruze", '34544', '32927', '16386', 'Reshmi.Narang', '33018', 'Amandeep.Chaudhri', 'guru.test', '18156', '33371', 'narin', '16587', '33474', '34543', 'dhirav1', '33378', '33453', 'Reshma.Begum', '32965', 'Rameshwar.Patil', 'Hardeep.Choudhary', '33521', 'Jyothi.Ahmad', '17113', '32887', '34315', '34009', '34007', '33450', '16905', '33962', 'Ninad.Ahmed', '16617', 'ramakrishna', '34471', 'akruti.akruti', '34451', 'Harshada.Rao', '32839', '16515', '34322', 'LTB150002', 'LTB150011', '33340', 'ankush018', '33528', "Amitabh.D'Cruz", '34365', 'Dhaval.Nibhanupudi', '34348', '99999', '34401', '34465', '33526', '34325', '34547', '16577', '32896', '34519', 'ani1', '17980', '33844', '33800', '34501', 'raka', '33360', '33302', 'aa123', 'Nila.Chaudhri', 'converter11', 'Sandeep.Patil', 'Gurdeep.Nagarkar', '33532', 'ron', '33427', '33818', 'Harpreet.Nibhanupudi', '32899', '33520', '34433', '34469', 'Meena.Rao', 'Harish.Anand', '34439', 'Sameera.Tirrell', 'Jayanti12345', '34397', 'Padmini.Chaudhary', '33529', '34464', '32894', '34402', '33860', 'LTB150009', 'Talia.Adamson', '18145', '33339', '34483', 'devbramhmadevbramhma', 'ishal887', '34510', '32778', '16395', '33386', '34453', '34012', '33533', '32824', '34317', '16897', '34511', 'Vipul.Kaur', 'Minali.Gadhavi', '34456', 'Jyothi.Rao', 'Jaidev.Chaudhari', '33451', 'Anushka.Das', '32919', '33328', '34363', '34549', 'Lakshmi.Joshi', '34505', '66666', 'Don', 'chimur.chokra', 'Jennica.Ross', '33343', '33913', 'duke', 'dfsdfsdf', '34448', '34321', '33379', 'Tejas6253', 'Dip.Ahmed', '32883', '32893', '16971', '32840', '32938', 'Ratnam.Jain', '33801', 'Nilam.Korrapati', 'Saral.Singh', '34333', '33500', 'Natasha', '33975', '32889', 'usercristfure', '34029', 'Samira.Narang', 'Amandeep.Jain', '33341', '34496', 'LTB150050', '34313', 'Nitin.Mishra', '34523', '33901', '17037', '33364', 'Rajeshk23', 'Pawan736', '33362', 'Deepika.Kulkarni', '33330', '32843', 'Mohinder.Patel', '34398', 'Sanjana.Misra', '18068', '33383', '16970', '34356', 'Kasi.Gupta', '34534', '34556', 'Padma.Jain', 'rant44', '34466', '33398', 'converter12', 'Dipali.Tamboli', 'Mohandas.Joshi', 'Gurpreet.Tamboli', 'vrush1', 'Sri.Singh', '33506', '33531', 'LTB150010', '33281', 'Nikhil.Ahmed', 'ganesh33', '34450', '33998', '33489', '16430', '34498', 'Suman.Vemulakonda', '18001', 'Rina.Ahmad', '34472', '33996', '18162', 'kumar1', '33462', '33470', '16949', '33321', 'Indra.Narang', "Siva.D'Cruze", '34507', '18135', 'Radha.Mishra', 'Ramkrishna.Devi', 'Amarjeet.Vemulakonda', 'QuintondeKock', 'Kamini.Kaur', 'Girish735', '34316', 'Durga.Chaudhari', 'Suman.Singh', 'Khushi.Bachchan', 'Vasuda.Gupta', '17041', 'Kenton.Pitt', 'Ajit.Shrivatsa', '33488', '16903', '16618', 'Laksh', '34446', '34013', 'LTB150004', '32831', '34380', '34334', '18016', 'Puneet.Mishra', 'tansan656', 'Mina.Bachchan', '32805', '17004', '32932', 'Nanda.Kumar', '18153', 'Kanta.Jain', '32872', '16535', 'Priyanka.Mishra', 'eurodoller', '34394', '18175', 'Vihaan.Narang', '32845', 'yash12', 'Gopal.Kaur', '33983', '34535', '16455', "Govinda.D'Cruz", '17927', '33960', '33517', '34499', 'Tushar.Anand', 'Prathmesh11', '33876', 'Amrita.Rao', 'HarshadaRao', 'LTB150013', '32986'}
# Cymmetri_logins = ['sahilp', 'sahil123', '74681']


import redis
import json

# Redis connection parameters
REDIS_HOST = '10.0.1.7'
REDIS_PORT = 6379
REDIS_USERNAME = 'infra'
REDIS_PASSWORD = 'infra@123'
REDIS_DATABASE = 1

# Connect to Redis
try:
    r = redis.Redis(
        host=REDIS_HOST,
        port=REDIS_PORT,
        username=REDIS_USERNAME,
        password=REDIS_PASSWORD,
        db=REDIS_DATABASE,
        decode_responses=True  # Decode responses to strings
    )
    # Test the connection
    print("Connected to Redis successfully!")
    
    # Key of the data
    key = "65f8430941fd647553ffbcea"

    # Get the string value from Redis
    string_value = r.get(key)

    # Parse the string value as JSON
    if string_value:
        data_list = json.loads(string_value)

        # Count the number of elements in the list
        num_elements = len(data_list)
        print("Number of elements in the list:", num_elements)
    else:
        print("Key not found or value is empty.")

except Exception as e:
    print("Failed to connect to Redis:", e)
